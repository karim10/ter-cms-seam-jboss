<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:s="http://jboss.com/products/seam/taglib"
	  xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:ui="http://java.sun.com/jsf/facelets">
	
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script language="JavaScript" src="script/upload.js" type="text/javascript">
            
   </script>
</head>
		<ui:composition>
	  	<div align="center">	
			<rich:panel id="majU" headerClass="rich-panel-header-adm" bodyClass="rich-panel-body-acc">
			<f:facet name="header">
				<h2>Ajout d'un nouveau article</h2>        
        	</f:facet>
        	<s:fragment rendered="#{(empty sessionUtilisateur.utilisateur.contenuGestionnaire and 
								empty sessionUtilisateur.utilisateur.contenuRedacteur) and
								not sessionUtilisateur.utilisateur.admin}">
				<h:outputText value="Vous n'avez pas les droits nécessaire pour ajouter un article" />
				</s:fragment>
				<s:fragment rendered="#{not empty sessionUtilisateur.utilisateur.contenuGestionnaire
								or not empty sessionUtilisateur.utilisateur.contenuRedacteur
								or sessionUtilisateur.utilisateur.admin}">
		   <h:form>
					<h:panelGrid columns="2" columnClasses="top,top">
            <rich:fileUpload fileUploadListener="#{fileUploadBean.listenerFiles}"
                			maxFilesQuantity="#{fileUploadBean.uploadsAvailable}"
                			uploadData="#{file.data}"
                			id="upload"
                			addControlLabel="Ajouter un fichier..." 
                			clearAllControlLabel="Supprimer Tout" 
                			clearControlLabel="Supprimer"
							stopEntryControlLabel="Arêter" 
							uploadControlLabel="Joindre"
							immediateUpload="#{fileUploadBean.autoUpload}"
                			acceptedTypes="jpg, gif, png, bmp"
                			noDuplicate="true"
                			allowFlash="true"
                			listHeight="50"  
                       		listWidth="500"  
                     		style="height:100;">
                <a4j:support event="onuploadcomplete" reRender="info" />
                
                
            </rich:fileUpload>
            <h:panelGroup id="info">
                <rich:panel bodyClass="info">
                    <f:facet name="header">
                        <h:outputText value="Uploaded Files Info" />
                    </f:facet>
                    <h:outputText value="No files currently uploaded"
                        rendered="#{fileUploadBean.size==0}" />
                    <rich:dataGrid columns="1" value="#{fileUploadBean.files}"
                        var="file" rowKeyVar="row">
                        <rich:panel bodyClass="rich-laguna-panel-no-header">
                            <h:panelGrid columns="2">
                                <a4j:mediaOutput element="img" mimeType="#{file.mime}"
                                    createContent="#{fileUploadBean.paint}" value="#{row}"
                                    style="width:100px; height:100px;" cacheable="false">
                                    <f:param value="#{fileUploadBean.timeStamp}" name="time"/>  
                                </a4j:mediaOutput>
                                <h:panelGrid columns="2">
                                    <h:outputText value="File Name:" />
                                    <h:outputText value="#{file.name}" />
                                    <h:outputText value="File Length(bytes):" />
                                    <h:outputText value="#{file.size}" />
                                </h:panelGrid>
                            </h:panelGrid>
                        </rich:panel>
                    </rich:dataGrid>
                   
                </rich:panel>
                
                <rich:spacer height="3"/>
                <br />
                <a4j:commandButton styleClass="button" action="#{fileUploadBean.clearUploadData}"
                    reRender="info, upload" value="Clear Uploaded Data"
                    rendered="#{fileUploadBean.size>0}" />
            </h:panelGroup>
        </h:panelGrid>
        </h:form>
		   <a4j:form id="ajoutArticle" ajaxSubmit="true" reRender="titre,sousTitre,description,texte">
		     <table border="0">
		       <s:validateAll> 
		         <tr>
		           <td>Titre de l'article<br />
		           		<h:inputText id="titre" value="#{article.titreContenu}" required="true" size="66">
		           			<rich:ajaxValidator event="onblur"/>
		           		</h:inputText>
		           		<br/>
		           		<rich:message  errorClass="erreur" for="titre"/>
		           </td>
		           <td>Niveau d'accès<br />
			           <h:selectOneMenu value="#{article.niveauAcces}" required="true">
			  				<s:selectItems id="niveauacces"
			  								value="#{enum.getListNiveauAcces()}" 
			  								var="niveauAcces" 
			  								label="#{niveauAcces.label}"
			  								noSelectionLabel="Choisissez svp"/>
			  								
			  				<s:convertEnum />
						</h:selectOneMenu><br />
						<rich:message  errorClass="erreur" for="niveauacces"/>
    			   </td>
    			   <td>
    			  
					

    			   </td>
		         </tr>
		         
		         <tr>
		           
		           <td>Sous Titre<br />
		           		<h:inputTextarea id="sousTitre" value="#{article.sousTitre}" rows="1" cols="50"/><br />
		           		<rich:message errorClass="erreur" for="sousTitre"/>
		           	</td>
		           	<td>Rubrique Parent<br />
		           
    				  <h:selectOneMenu value="#{article.parent}" required="true">
					  			<s:selectItems 	id="parent"
					  							value="#{gestionContenu.chargeParent(null,sessionUtilisateur.utilisateur)}" 
					  							var="ctn" 
					  							label="#{ctn.titreContenu}"
					  							noSelectionLabel="Choisissez svp "
					  							/>
					  							<f:converter converterId="rubriqueConverter"/>		
								</h:selectOneMenu><br />
    				<rich:message errorClass="erreur" for="parent"/>
					</td>
					
		         </tr>
		         <tr>
		          
		           <td>Description<br />
		           		<h:inputTextarea id="description" value="#{article.description}" cols="50"/><br />
		           		<rich:message  errorClass="erreur" for="description"/>
		           </td>
		           <td>Lien Web<br />
		           		<h:inputText value="#{article.lienWeb}"/>
		           </td>
		           
		         </tr>
		         <tr>
		         	<td>Date de création 
						<rich:calendar id="dateC" datePattern="dd/M/yy"  value="#{article.dateCreation}" require="true"/>
						<rich:message errorClass="erreur" for="dateC"/>
					</td>
					
		         </tr>
		         <tr>
		           
		           <td>Texte de l'article
		           		 <rich:editor value="#{article.texte}" theme="advanced" language="fr"  width="400" height="400" style="p"
		           		   plugins="save,paste,cut"  useSeamText="true" id="texte" autoResize="true" label="Texte de l'Article">
          					<f:param name="theme_advanced_toolbar_location" value="top"/>
          					<f:param name="theme_advanced_buttons1" value="bold,italic,underline, cut,copy,paste,pasteword"/>                               
          					<f:param name="theme_advanced_toolbar_align" value="left"/>
						</rich:editor><br />
						<rich:message errorClass="erreur" for="texte"/>
		           </td>
		         </tr>
		       </s:validateAll>
		       <tr>
		       		<td>
		       			 <rich:messages  errorClass="erreur"/>
		     			<h:commandButton type="submit" class="button" value="valider" action="#{gestionContenu.addContenu(article,fileUploadBean.files)}"/>
		       		</td>
		       		<td>
		       			 <s:button value="retour"  styleClass="button" action="#{menu.afficheGestionArticle()}"/>
		       		</td>
		       </tr>
		     </table>    
		   </a4j:form>
		   
		   </s:fragment>
		   </rich:panel>
		 </div>
	</ui:composition>
</html>